(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     17251,        541]
NotebookOptionsPosition[     15903,        491]
NotebookOutlinePosition[     16264,        507]
CellTagsIndexPosition[     16221,        504]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"SetDirectory", "@", 
  RowBox[{"NotebookDirectory", "[", "]"}]}]], "Input",
 CellChangeTimes->{{3.705540765747752*^9, 3.705540774983152*^9}}],

Cell[BoxData["\<\"/Users/yunqiguo/Document/CS249_2/project/249-Sun/src\"\>"], \
"Output",
 CellChangeTimes->{3.705540776943944*^9, 3.705540892877816*^9, 
  3.705540931577796*^9, 3.705702552028626*^9, 3.7057038131655293`*^9, 
  3.705704695240575*^9, 3.705708013439104*^9, 3.705708845741802*^9, 
  3.7057625759257307`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"purity", "[", 
   RowBox[{"c_", ",", "w_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "inter", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"inter", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Length", "@", 
         RowBox[{"Intersection", "[", 
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"w", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "c"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "@", "w"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "@", 
      RowBox[{"N", "[", 
       FractionBox[
        RowBox[{"Total", "@", 
         RowBox[{"(", 
          RowBox[{"Max", "/@", "inter"}], ")"}]}], 
        RowBox[{"Total", "@", 
         RowBox[{"(", 
          RowBox[{"Length", "/@", "c"}], ")"}]}]], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.705546249506269*^9, 3.7055463703811693`*^9}, {
  3.7055465004475594`*^9, 3.705546523291565*^9}, {3.70554661868929*^9, 
  3.70554663462607*^9}}],

Cell[BoxData[
 RowBox[{"<<", "../data/edges.mx"}]], "Input",
 CellChangeTimes->{{3.705540784583576*^9, 3.705540796531398*^9}, {
  3.705540895291058*^9, 3.7055409096256523`*^9}}],

Cell[BoxData[
 RowBox[{"<<", "../data/top5.mx"}]], "Input",
 CellChangeTimes->{{3.705543356383108*^9, 3.705543365833597*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"g", "=", 
   RowBox[{"Graph", "[", "edges", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7055409112679253`*^9, 3.705540954800796*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"distance", "=", 
   RowBox[{"GraphDistanceMatrix", "[", "g", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.705541014570251*^9, 3.705541017769712*^9}, {
  3.705541231871791*^9, 3.705541242660645*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"vDic", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Association", "@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", "i"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "#"}]}], "}"}]}], "]"}]}], "&"}], "@", 
    RowBox[{"VertexList", "[", "g", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7055415087766743`*^9, 3.705541607732588*^9}}],

Cell[CellGroupData[{

Cell["State of Art", "Subchapter",
 CellChangeTimes->{{3.705544894848559*^9, 3.705544902211824*^9}, {
  3.70576404722418*^9, 3.705764049426951*^9}, {3.7057642159722757`*^9, 
  3.705764224705791*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"communities0", "=", 
   RowBox[{"FindGraphPartition", "[", 
    RowBox[{"g", ",", "5"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.705543994387968*^9, 3.7055440349795856`*^9}, {
  3.705544077759564*^9, 3.705544152955905*^9}, {3.705544210633409*^9, 
  3.705544235893153*^9}, {3.705703315373892*^9, 3.705703324428698*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"purity", "[", 
  RowBox[{"communities0", ",", "top5"}], "]"}]], "Input",
 CellChangeTimes->{{3.705544171207876*^9, 3.70554418874898*^9}, 
   3.70554424133365*^9, {3.705546467346265*^9, 3.7055464776150417`*^9}}],

Cell[BoxData["0.5679990201281999`"], "Output",
 CellChangeTimes->{
  3.705544189327231*^9, 3.705544241835828*^9, {3.705546478017807*^9, 
   3.705546506705409*^9}, 3.705546700428141*^9, 3.705547491718841*^9, 
   3.70554753595787*^9, 3.705764040477902*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"communities", "=", 
   RowBox[{"FindGraphPartition", "[", 
    RowBox[{"g", ",", "1500"}], "]"}]}], ";"}], "\n", 
 RowBox[{"Length", "@", "communities"}], "\n", 
 RowBox[{
  RowBox[{"communityDistanceMatrix", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"N", "@", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"distance", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"vDic", "/@", 
            RowBox[{"communities", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"vDic", "/@", 
            RowBox[{"communities", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], "]"}]}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "@", "communities"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", 
       RowBox[{"Length", "@", "communities"}]}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"g2", "=", 
    RowBox[{"WeightedAdjacencyGraph", "[", 
     RowBox[{"1", "/", "communityDistanceMatrix"}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{"\"\<communityDistanceMatrix.csv\>\"", ",", 
      RowBox[{"communityDistanceMatrix", "//", "TableForm"}]}], "]"}], ";"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"communities4", "=", 
   RowBox[{"FindGraphCommunities", "[", 
    RowBox[{"g2", ",", 
     RowBox[{"Method", "\[Rule]", "\"\<Spectral\>\""}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{"Length", "@", "communities4"}], "\n", 
 RowBox[{
  RowBox[{"c4Size", "=", 
   RowBox[{"Length", "@", "communities4"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"distance2", "=", 
   RowBox[{"GraphDistanceMatrix", "[", "g2", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"vDic2", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Association", "@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", "i"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "#"}]}], "}"}]}], "]"}]}], "&"}], "@", 
    RowBox[{"VertexList", "[", "g2", "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"communityDistanceMatrix2", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"N", "@", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"distance2", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"vDic2", "/@", 
            RowBox[{"communities4", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"vDic2", "/@", 
            RowBox[{"communities4", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], "]"}]}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "c4Size"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "c4Size"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"nearests", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", 
        RowBox[{"Min", "[", "#", "]"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], "&"}], "/@", " ", 
    RowBox[{"communityDistanceMatrix2", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"6", ";;"}], ",", 
       RowBox[{"1", ";;", "5"}]}], "]"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"communities5", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"communities4", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"Flatten", "@", " ", 
        RowBox[{"communities4", "[", 
         RowBox[{"[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"nearests", ",", "i"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "+", "5"}], "]"}], 
         "]"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "5"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"purity", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"communities", "[", 
       RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", "communities5"}], 
   ",", "top5"}], "]"}]}], "Input",
 CellChangeTimes->{{3.7057642579624367`*^9, 3.705764275294705*^9}}],

Cell[BoxData["1500"], "Output",
 CellChangeTimes->{3.705764277838457*^9}],

Cell[BoxData["21"], "Output",
 CellChangeTimes->{3.7057643299623747`*^9}],

Cell[BoxData["0.6398562854693177`"], "Output",
 CellChangeTimes->{3.705764333295442*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["r+mathematica", "Subchapter",
 CellChangeTimes->{{3.7057626263784857`*^9, 3.705762630932722*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"clustering", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"\"\<../communities/infomap.txt\>\"", ",", "\"\<Data\>\""}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"clustering", "=", 
   RowBox[{"ToExpression", "/@", 
    RowBox[{"StringSplit", "[", 
     RowBox[{"clustering", ",", "\"\< \>\""}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"communities", "=", "clustering"}], ";"}], "\n", 
 RowBox[{"Length", "@", "communities"}], "\n", 
 RowBox[{
  RowBox[{"communityDistanceMatrix", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"N", "@", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"distance", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"vDic", "/@", 
            RowBox[{"communities", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"vDic", "/@", 
            RowBox[{"communities", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], "]"}]}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "@", "communities"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", 
       RowBox[{"Length", "@", "communities"}]}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"nearests", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", 
        RowBox[{"Min", "[", "#", "]"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], "&"}], "/@", " ", 
    RowBox[{"communityDistanceMatrix", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"6", ";;"}], ",", 
       RowBox[{"1", ";;", "5"}]}], "]"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"communitiesFinal", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"communities", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"Flatten", "@", " ", 
        RowBox[{"communities", "[", 
         RowBox[{"[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"nearests", ",", "i"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "+", "5"}], "]"}], 
         "]"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "5"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"purity", "[", 
  RowBox[{"communitiesFinal", ",", "top5"}], "]"}]}], "Input",
 CellChangeTimes->{{3.705763802398588*^9, 3.705763810424364*^9}}],

Cell[BoxData["1829"], "Output",
 CellChangeTimes->{3.7057638144713583`*^9}],

Cell[BoxData["0.46633732086718654`"], "Output",
 CellChangeTimes->{3.705763867718479*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"g2", "=", 
   RowBox[{"WeightedAdjacencyGraph", "[", 
    RowBox[{"1", "/", "communityDistanceMatrix"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"communities4", "=", 
   RowBox[{"FindGraphCommunities", "[", 
    RowBox[{"g2", ",", 
     RowBox[{"Method", "\[Rule]", "\"\<Spectral\>\""}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{"Length", "@", "communities4"}], "\n", 
 RowBox[{
  RowBox[{"c4Size", "=", 
   RowBox[{"Length", "@", "communities4"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"distance2", "=", 
   RowBox[{"GraphDistanceMatrix", "[", "g2", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"vDic2", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Association", "@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", "i"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "#"}]}], "}"}]}], "]"}]}], "&"}], "@", 
    RowBox[{"VertexList", "[", "g2", "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"communityDistanceMatrix2", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"N", "@", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"distance2", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"vDic2", "/@", 
            RowBox[{"communities4", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"vDic2", "/@", 
            RowBox[{"communities4", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}], "]"}]}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "c4Size"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "c4Size"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"nearests", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", 
        RowBox[{"Min", "[", "#", "]"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], "&"}], "/@", " ", 
    RowBox[{"communityDistanceMatrix2", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"6", ";;"}], ",", 
       RowBox[{"1", ";;", "5"}]}], "]"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"communities5", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"communities4", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"Flatten", "@", " ", 
        RowBox[{"communities4", "[", 
         RowBox[{"[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"nearests", ",", "i"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "+", "5"}], "]"}], 
         "]"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "5"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"purity", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"communities", "[", 
       RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", "communities5"}], 
   ",", "top5"}], "]"}]}], "Input",
 CellChangeTimes->{{3.705763649396291*^9, 3.705763649995632*^9}, {
  3.705763690488371*^9, 3.705763708857465*^9}, {3.7057639575381107`*^9, 
  3.705764002691235*^9}}],

Cell[BoxData["46"], "Output",
 CellChangeTimes->{
  3.705763673080144*^9, {3.705763714951194*^9, 3.70576373589517*^9}}],

Cell[BoxData["0.5087576042134487`"], "Output",
 CellChangeTimes->{
  3.705763673080144*^9, {3.705763714951194*^9, 3.705763741782145*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{769, 385},
WindowMargins->{{218, Automatic}, {132, Automatic}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 165, 3, 32, "Input"],
Cell[748, 27, 320, 5, 32, "Output"]
}, Open  ]],
Cell[1083, 35, 1300, 37, 132, "Input"],
Cell[2386, 74, 177, 3, 32, "Input"],
Cell[2566, 79, 125, 2, 32, "Input"],
Cell[2694, 83, 172, 4, 32, "Input"],
Cell[2869, 89, 236, 5, 32, "Input"],
Cell[3108, 96, 527, 15, 32, "Input"],
Cell[CellGroupData[{
Cell[3660, 115, 199, 3, 63, "Subchapter"],
Cell[3862, 120, 361, 7, 32, "Input"],
Cell[CellGroupData[{
Cell[4248, 131, 234, 4, 32, "Input"],
Cell[4485, 137, 254, 4, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4776, 146, 4363, 130, 516, "Input"],
Cell[9142, 278, 73, 1, 32, "Output"],
Cell[9218, 281, 73, 1, 32, "Output"],
Cell[9294, 284, 88, 1, 32, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[9431, 291, 103, 1, 63, "Subchapter"],
Cell[CellGroupData[{
Cell[9559, 296, 2541, 74, 285, "Input"],
Cell[12103, 372, 75, 1, 32, "Output"],
Cell[12181, 375, 89, 1, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12307, 381, 3306, 98, 369, "Input"],
Cell[15616, 481, 119, 2, 32, "Output"],
Cell[15738, 485, 137, 2, 32, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

